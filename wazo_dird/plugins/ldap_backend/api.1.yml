paths:
  /backends/ldap/sources:
    get:
      operationId: list_ldap_source
      summary: Get all `ldap` source configurations
      description: '**Required ACL:** `dird.backends.ldap.sources.read`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/recurse'
        - $ref: '#/parameters/order'
        - $ref: '#/parameters/direction'
        - $ref: '#/parameters/Limit'
        - $ref: '#/parameters/Offset'
      responses:
        '200':
          description: A list of configured `ldap` sources
          schema:
            $ref: '#/definitions/LDAPSourceItems'
    post:
      operationId: create_ldap_source
      summary: Configure a source for the `ldap` backend
      description: '**Required ACL:** `dird.backends.ldap.sources.create`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - name: body
          in: body
          description: The display configuration body
          required: true
          schema:
            $ref: '#/definitions/LDAPSource'
      responses:
        '201':
          description: The created display
          schema:
            $ref: '#/definitions/LDAPSource'
          examples:
            application/json:
              name: ldap
              searched_columns:
                - firstname
                - lastname
              format_columns:
                firstname: '{givenName}'
                lastname: '{sn}'
                displayname: '{displayName}'
                exten: '{telephoneNumber}'
              ldap_uri: 'ldap://example.com'
              ldap_base_dn: 'ou=people,dc=example,dc=com'
              ldap_custom_filter: '(l=québec)'
              ldap_username: 'cn=admin,dc=example,dc=org'
              ldap_password: foobar
              unique_column: objectGUID
              unique_column_format: binary_uuid
        '400':
          $ref: '#/responses/CreateError'
        '409':
          description: Duplicate Source
          schema:
            $ref: '#/definitions/Error'
  /backends/ldap/sources/{source_uuid}:
    get:
      operationId: get_a_ldap_source
      summary: Get a `ldap` source configuration
      description: '**Required ACL:** `dird.backends.ldap.sources.{source_uuid}.read`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/sourceuuid'
      responses:
        '200':
          description: The `ldap` source
          schema:
            $ref: '#/definitions/LDAPSource'
        '404':
          $ref: '#/responses/NotFoundError'
    put:
      operationId: update_ldap_source
      summary: Update a `ldap` source configuration
      description: '**Required ACL:** `dird.backends.ldap.sources.{source_uuid}.update`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/sourceuuid'
        - name: body
          in: body
          description: The source configuration body
          required: true
          schema:
            $ref: '#/definitions/LDAPSource'
      responses:
        '204':
          $ref: '#/responses/ResourceUpdated'
        '400':
          $ref: '#/responses/UpdateError'
        '404':
          $ref: '#/responses/NotFoundError'
        '409':
          description: Duplicate Source
          schema:
            $ref: '#/definitions/Error'
    delete:
      operationId: delete_ldap_source
      summary: Delete a `ldap` source configuration
      description: '**Required ACL:** `dird.backends.ldap.sources.{source_uuid}.delete`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/sourceuuid'
      responses:
        '204':
          $ref: '#/responses/ResourceDeleted'
        '404':
          $ref: '#/responses/NotFoundError'
definitions:
  LDAPSource:
    title: LDAPSource
    allOf:
      - $ref: '#/definitions/Source'
      - properties:
          ldap_uri:
            type: string
            description: the URI of the LDAP server. Can only contains the scheme, host and port part of an LDAP URL
          ldap_base_dn:
            type: string
            description: the DN of the entry at which to start the search
          ldap_username:
            type: string
            description: the user’s DN to use when performing a “simple” bind.
          ldap_password:
            type: string
            description: the password to use when performing a “simple” bind.
          ldap_custom_filter:
            type: string
            description: the custom filter is used to add more criteria to the filter generated by the back end.
          ldap_network_timeout:
            type: number
            description: the maximum time, in second, that an LDAP network operation can take. If it takes more time than that, no result is returned.
            default: 0.3
          ldap_timeout:
            type: number
            description: the maximum time, in second, that an LDAP operation can take.
            default: 1.0
          unique_column:
            type: string
            description: the column that contains a unique identifier of the entry
          unique_column_format:
            type: string
            enum: [string, binary_uuid]
            description: the unique column’s type returned by the queried LDAP server.
      - required:
        - name
        - ldap_uri
        - ldap_base_dn
  LDAPSourceItems:
    title: LDAPSourceItems
    allOf:
      - $ref: '#/definitions/SourceItems'
      - properties:
          items:
            type: array
            items:
              $ref: '#/definitions/LDAPSource'
            readOnly: true
      - required:
          - items
          - total
          - filtered
